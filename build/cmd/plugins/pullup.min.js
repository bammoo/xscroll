define(function(n,e,t){"use strict";var r,i=n("../util"),l=n("../base"),s="Loading...",o="Pull Up To Refresh",u="Release To Refresh",a=60,c=40,g=function(n){g.superclass.constructor.call(this),this.userConfig=i.mix({upContent:o,downContent:u,pullUpHeight:a,height:c,loadingContent:s,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},n)};if(i.extend(g,l,{pluginId:"pullup",pluginInitializer:function(n){var e=this;return e.xscroll=n.render(),r=e.userConfig.clsPrefix,e.render(),e},pluginDestructor:function(){var n=this;i.remove(n.pullup),n.xscroll.off("scrollend",n._scrollEndHandler,n),n.xscroll.off("scroll",n._scrollHandler,n),n.xscroll.off("pan",n._panHandler,n),n.xscroll.boundry.resetBottom(),n.__isRender=!1,n._evtBinded=!1},render:function(){var n=this;if(!n.__isRender){if(n.__isRender=!0,n.userConfig.container)n.pullup=n.userConfig.container;else{var e=r+"container",t=n.userConfig.height,l=n.pullup=document.createElement("div");l.className=e,l.style.position="absolute",l.style.width="100%",l.style.height=t+"px",l.style.bottom=-t+"px",l.style.textAlign="center",n.xscroll.container.appendChild(l),i.addClass(l,r+n.status),l.innerHTML=n.userConfig[n.status+"Content"]||n.userConfig.content}return n.xscroll.boundry.expandBottom(n.userConfig.height),n.status="up",n._bindEvt(),n}},_bindEvt:function(){var n=this;if(!n._evtBinded){n._evtBinded=!0;var e=(n.pullup,n.xscroll);return e.on("pan",n._panHandler,n),n.userConfig.bufferHeight>0&&e.on("scroll",n._scrollHandler,n),e.on("scrollend",n._scrollEndHandler,n),n}},_scrollEndHandler:function(n){var e=this,t=e.xscroll,r=t.getScrollTop();return r==t.containerHeight-t.height+e.userConfig.height&&e._changeStatus("loading"),e},_scrollHandler:function(n){var e=this,t=e.xscroll;return!e.isLoading&&Math.abs(n.scrollTop)+t.height+e.userConfig.height+e.userConfig.bufferHeight>=t.containerHeight+t.boundry._xtop+t.boundry._xbottom&&e._changeStatus("loading"),e},_panHandler:function(n){var e=this,t=e.xscroll,r=-t.getScrollTop();return r<t.height-t.containerHeight-e.userConfig.pullUpHeight?e._changeStatus("down"):e._changeStatus("up"),e},_changeStatus:function(n){if("loading"==n||!this.isLoading){var e=this.status;return this.status=n,this.userConfig.container||(i.removeClass(this.pullup,r+e),i.addClass(this.pullup,r+n),this.pullup.innerHTML=this.userConfig[n+"Content"]),e!=n&&(this.trigger("statuschange",{prevVal:e,newVal:n}),"loading"==n&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){var n=this;n.xscroll;return n.isLoading=!1,n._changeStatus("up"),n}}),"object"==typeof t&&t.exports)t.exports=g;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullUp=g});