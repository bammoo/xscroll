define(function(t,n,e){"use strict";var r,i=t("../util"),l=t("../base"),s="Loading...",o="Pull Up To Refresh",u="Release To Refresh",a=60,c=40,g=function(t){g.superclass.constructor.call(this),this.userConfig=i.mix({upContent:o,downContent:u,pullUpHeight:a,height:c,loadingContent:s,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},t)};if(i.extend(g,l,{pluginId:"pullup",pluginInitializer:function(t){var n=this;return n.xscroll=t.render(),r=n.userConfig.clsPrefix,n.render(),n},pluginDestructor:function(){var t=this;i.remove(t.pullup),t.xscroll.off("scrollend",t._scrollEndHandler,t),t.xscroll.off("scroll",t._scrollHandler,t),t.xscroll.off("pan",t._panHandler,t),t.xscroll.boundry.resetBottom(),t.__isRender=!1,t._evtBinded=!1},render:function(){var t=this;if(!t.__isRender){if(t.__isRender=!0,t.userConfig.container)t.pullup=t.userConfig.container;else{var n=r+"container",e=t.userConfig.height,l=t.pullup=document.createElement("div");l.className=n,l.style.position="absolute",l.style.width="100%",l.style.height=e+"px",l.style.bottom=-e+"px",l.style.textAlign="center",t.xscroll.container.appendChild(l),i.addClass(l,r+t.status),l.innerHTML=t.userConfig[t.status+"Content"]||t.userConfig.content}return t.xscroll.boundry.expandBottom(t.userConfig.height),t.status="up",t._bindEvt(),t}},_bindEvt:function(){var t=this;if(!t._evtBinded){t._evtBinded=!0;var n=(t.pullup,t.xscroll);return n.on("pan",t._panHandler,t),t.userConfig.bufferHeight>0&&n.on("scroll",t._scrollHandler,t),n.on("scrollend",t._scrollEndHandler,t),t}},_scrollEndHandler:function(t){var n=this,e=n.xscroll,r=e.getScrollTop();return r==e.containerHeight-e.height+n.userConfig.height&&n._changeStatus("loading"),n},_scrollHandler:function(t){var n=this,e=n.xscroll;return!n.isLoading&&Math.abs(t.scrollTop)+e.height+n.userConfig.height+n.userConfig.bufferHeight>=e.containerHeight+e.boundry._xtop+e.boundry._xbottom&&n._changeStatus("loading"),n},_panHandler:function(t){var n=this,e=n.xscroll,r=-e.getScrollTop();return r<e.height-e.containerHeight-n.userConfig.pullUpHeight?n._changeStatus("down"):n._changeStatus("up"),n},_changeStatus:function(t){if("loading"==t||!this.isLoading){var n=this.status;return this.status=t,this.userConfig.container||(i.removeClass(this.pullup,r+n),i.addClass(this.pullup,r+t),this.pullup.innerHTML=this.userConfig[t+"Content"]),n!=t&&(this.trigger("statuschange",{prevVal:n,newVal:t}),"loading"==t&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){var t=this;t.xscroll;return t.isLoading=!1,t._changeStatus("up"),t},stop:function(){var t=this;t.xscroll;return t.isLoading=!1,t._changeStatus("stop"),t.pluginDestructor(),t},restart:function(){var t=this;t.xscroll;return t.isLoading=!1,t._changeStatus("default"),t.render(),t}}),"object"==typeof e&&e.exports)e.exports=g;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullUp=g});